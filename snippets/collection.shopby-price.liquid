<section class="filter-price filter-tag">
  <div class="widget-title">
    <h2 class="mb-0">{{ settings.shop_by_price_title }}</h2>
  </div>

  {% assign price_ranges = "10 - 20,20 - 30,30 - 50,50 - 100,100 - 200" | split: "," %}

  <ul class="list-none list-price">
    {% for range in price_ranges %}
      {% if range != "" %}
        {% assign prices = range | split: " - " %}
        <li class="cat-item">
          <input type="checkbox" value="{{ prices[0] }}-{{ prices[1] }}" id="price-filter-{{ forloop.index }}">
          <a href="javascript:void(0)" title="{{ range }}" class="price-filter" data-min="{{ prices[0] }}" data-max="{{ prices[1] }}">
            <span class="price-text">{{ prices[0] }} - {{ prices[1] }}</span>
          </a>
        </li>
      {% endif %}
    {% endfor %}
  </ul>
  <!-- /.product-categories -->
</section>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    function updatePriceFilters() {
      var currencyFormat = Shopify.formatMoney(1, "{{amount}}"); // Get the currency format from Shopify

      document.querySelectorAll('.price-filter').forEach(function(filter) {
        var minPrice = parseFloat(filter.dataset.min);
        var maxPrice = parseFloat(filter.dataset.max);

        // Use Shopify's Currency conversion API
        var convertedMinPrice = Shopify.formatMoney(minPrice * 100, currencyFormat); // multiply by 100 because Shopify uses cents
        var convertedMaxPrice = Shopify.formatMoney(maxPrice * 100, currencyFormat); // multiply by 100 because Shopify uses cents

        filter.querySelector('.price-text').textContent = `${convertedMinPrice} - ${convertedMaxPrice}`;
      });
    }

    // Initial update
    updatePriceFilters();

    // Update when currency is changed
    document.addEventListener('currency:change', function() {
      updatePriceFilters();
    });
  });
</script>
